<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Registro ProducciÃ³n</title>

<style>
body{
  font-family: Arial;
  margin:40px;
}

form{
  margin-bottom:30px;
}

input, select{
  padding:8px;
  margin:5px;
}

button{
  padding:8px 15px;
  cursor:pointer;
}

table{
  border-collapse: collapse;
  width:100%;
}

th, td{
  border:1px solid #ccc;
  padding:8px;
  text-align:center;
}

th{
  background:#f2f2f2;
}
</style>

</head>
<body>

<h2>Registro ProducciÃ³n</h2>

<form id="formulario">

<input type="text" id="operador" placeholder="Operador" required>

<input type="text" id="exportadora" placeholder="Exportadora" required>

<select id="salida" required></select>

<input type="text" id="calibre" placeholder="Calibre" required>

<input type="text" id="categoria" placeholder="CategorÃ­a" required>

<input type="number" id="peso" placeholder="Peso (kg)" step="0.01" required>

<button type="submit">Guardar</button>

</form>

<table>
  <tbody id="tablaRegistros"></tbody>
</table>

<script>

const URL_SCRIPT = "https://script.google.com/macros/s/AKfycbxzTq-ZetGGskFJ2y6LNIv6d5WeXVZtZ8YLks-U0tKe_rpx44WR9lOsR2KJpw8rggpn/exec";

// ðŸ”¹ Generar salidas 1 a 41
const salidaSelect = document.getElementById("salida");

salidaSelect.innerHTML = '<option value="">Seleccione salida</option>';

for (let i = 1; i <= 41; i++) {
  let option = document.createElement("option");
  option.value = i;
  option.textContent = i;
  salidaSelect.appendChild(option);
}

// ðŸ”¹ Enviar formulario
document.getElementById("formulario").addEventListener("submit", function(e){

  e.preventDefault();

  const datos = {
    operador: document.getElementById("operador").value,
    exportadora: document.getElementById("exportadora").value,
    salida: document.getElementById("salida").value,
    calibre: document.getElementById("calibre").value,
    categoria: document.getElementById("categoria").value,
    peso: parseFloat(document.getElementById("peso").value)
  };

  fetch(URL_SCRIPT, {
    method: "POST",
    mode: "cors",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify(datos)
  })
  .then(res => res.json())
  .then(response => {

    if(response.status === "success"){
      alert("Registro guardado correctamente");
      document.getElementById("formulario").reset();
      cargarRegistros();
    } else {
      alert("Error al guardar: " + response.message);
    }

  })
  .catch(error => {
    alert("Error de conexiÃ³n");
    console.error(error);
  });

});

// ðŸ”¹ Cargar registros
function cargarRegistros() {

  fetch(URL_SCRIPT)
    .then(response => response.json())
    .then(data => {

      const tabla = document.getElementById("tablaRegistros");
      tabla.innerHTML = "";

      if (!data || data.length === 0) {
        tabla.innerHTML = "<tr><td colspan='8'>Sin registros</td></tr>";
        return;
      }

      // Encabezados
      let encabezado = "<tr>";
      data[0].forEach(columna => {
        encabezado += `<th>${columna}</th>`;
      });
      encabezado += "</tr>";

      tabla.innerHTML += encabezado;

      // ðŸ”¥ Mostrar Ãºltimos registros primero
      for (let i = data.length - 1; i > 0; i--) {

        let fila = "<tr>";

        for (let j = 0; j < data[i].length; j++) {
          fila += `<td>${data[i][j]}</td>`;
        }

        fila += "</tr>";
        tabla.innerHTML += fila;
      }

    })
    .catch(error => {
      console.error("Error cargando registros:", error);
    });
}

// Cargar al abrir
window.onload = cargarRegistros;

</script>

</body>
</html>
