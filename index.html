<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Registro Pesaje Manzana</title>

<style>
body { font-family: Arial; text-align: center; background:#f2f2f2; }
.container { margin-top:20px; }
input, select {
  font-size:18px;
  padding:8px;
  margin:6px;
  width:220px;
}
#guardar {
  background:green;
  color:white;
  width:220px;
  height:60px;
  font-size:22px;
}
table {
  margin:20px auto;
  border-collapse: collapse;
  width:95%;
  background:white;
}
th, td {
  border:1px solid #ccc;
  padding:8px;
  font-size:14px;
}
th {
  background:#4CAF50;
  color:white;
}
</style>
</head>

<body>

<div class="container">
<h2>Registro Pesaje üçé</h2>

<input type="text" id="usuario" placeholder="Nombre Operador"><br>

<select id="exportadora">
  <option value="">Seleccionar Exportadora</option>
  <option>Fruclem</option>
  <option>JHB</option>
  <option>Talamaya</option>
</select><br>

<select id="salida">
  <option value="">Seleccionar Salida</option>
</select><br>

<input type="text" id="calibre" placeholder="Ingresar Calibre"><br>

<select id="categoria">
  <option value="">Seleccionar Categor√≠a</option>
  <option>Premium</option>
  <option>Extra</option>
  <option>Fancy</option>
  <option>Choice</option>
  <option>Granel</option>
</select><br>

<input type="number" id="peso" placeholder="Peso (kg)" step="0.01"><br>

<button id="guardar" onclick="guardar()">GUARDAR</button>

<p id="mensaje"></p>
</div>

<h3>√öltimos Registros</h3>

<table>
<thead>
<tr>
<th>Fecha / Hora</th>
<th>Usuario</th>
<th>Exportadora</th>
<th>Salida</th>
<th>Calibre</th>
<th>Categoria</th>
<th>Peso</th>
</tr>
</thead>
<tbody id="tablaRegistros"></tbody>
</table>

<script>

const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzolgWH9tT3jlv8uzFCVE7b8z9GKZrS3ZR-e_ryqz0t4y0tVvOIZNOgER7j98jboXVG/exec";

// Generar salidas 1 a 41
for(let i=1; i<=41; i++){
  let option = document.createElement("option");
  option.text = i;
  option.value = i;
  document.getElementById("salida").add(option);
}

function guardar(){
  var usuario = document.getElementById("usuario").value.trim();
  var exportadora = document.getElementById("exportadora").value;
  var salida = document.getElementById("salida").value;
  var calibre = document.getElementById("calibre").value.trim();
  var categoria = document.getElementById("categoria").value;
  var peso = document.getElementById("peso").value;

  if(!usuario || !exportadora || !salida || !calibre || !categoria || !peso){
    alert("Complete todos los campos");
    return;
  }

  fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify({
      usuario: usuario,
      exportadora: exportadora,
      salida: salida,
      calibre: calibre,
      categoria: categoria,
      peso: peso
    })
  })
  .then(res => res.text())
  .then(data => {
    document.getElementById("mensaje").innerHTML = "Registro Guardado ‚úÖ";
    document.getElementById("calibre").value = "";
    document.getElementById("peso").value = "";
    cargarTabla();
  })
  .catch(error => {
    document.getElementById("mensaje").innerHTML = "Error al guardar ‚ùå";
  });
}

function cargarTabla(){
  fetch(SCRIPT_URL)
  .then(res => res.json())
  .then(data => {
    let tabla = document.getElementById("tablaRegistros");
    tabla.innerHTML = "";
    
    data.slice(-20).reverse().forEach(fila => {
      let fechaHora = fila[0] + " " + fila[1];

      let row = `<tr>
        <td>${fechaHora}</td>
        <td>${fila[2]}</td>
        <td>${fila[3]}</td>
        <td>${fila[4]}</td>
        <td>${fila[5]}</td>
        <td>${fila[6]}</td>
        <td>${fila[7]}</td>
      </tr>`;
      
      tabla.innerHTML += row;
    });
  });
}

cargarTabla();
setInterval(cargarTabla, 5000);

</script>

</body>
</html>
